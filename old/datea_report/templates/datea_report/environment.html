{% extends "site_base.html" %}

{% load i18n account_tags datea_profile_tags %}

{% block extra_head %}
	{{ block.super }}
	<script src="{{ STATIC_URL }}datea/js/datea_layout.js"></script> {# AL FINAL! #}
	<script type="text/javascript">
		Datea.is_frontend = true;
		Datea['environment'] = {{ environment_data_json|safe }};
		Datea.active.category = {{ active_category.id }};
		Datea.active.category_slug = '{{ active_category.slug }}';
		Datea.reports = {{ report_data|safe }}; 
	</script>
	
	{% if user.is_authenticated %}
	{{ report_form.media }}
	{% else %}
	<link href="{{ STATIC_URL }}olwidget/css/olwidget.css" type="text/css" media="all" rel="stylesheet" />
	<script src="{{ STATIC_URL }}openlayers/OpenLayers.js"></script>
	
	<script src="{{ STATIC_URL }}olwidget/js/olwidget.js"></script>
	<script type="text/javascript" src="//maps.google.com/maps/api/js?v=3.2&sensor=false&key={{ GOOGLE_API_KEY }}"></script>
	<script type="text/javascript" src="//openstreetmap.org/openlayers/OpenStreetMap.js"></script>
	{% endif %}
	
	<script src="{{ STATIC_URL }}datea/olwidget/js/datea_report_infolayer.js"></script> {# MAIN MAP LAYER #}
    <script src="{{ STATIC_URL }}datea/js/datea_maps_main.js"></script> {# MAIN MAP CODE #}
    
	<script src="{{ STATIC_URL }}datea/js/datea_navigation.js"></script>
	
{% endblock %}

{% block body_class %}
	{{ block.super }}
	{{ environment.slug }} environment
{% endblock %}

{% block head_title %}{{ environment.name }}{% endblock %}

{% block body_base %}
	
	{% block category_bar %}
		{% include "datea_report/_category_bar.html" %}
	{% endblock %}

	<div id="environment-menu">
		<div class="container">
			<ul id="environment-tabs" class="nav nav-tabs">
				{% if user.is_authenticated %}
					{% url environment_tab environment.slug "my-profile" as my_profile_url %}
					<li class="active"><a id="my-profile-tab" href="{{ my_profile_url }}" rel="nav:my-profile">MI PERFIL</a></li>
				{% endif %}
				{% url reports_list environment.slug active_category.slug as reports_url %}
				<li {% if not user.is_authenticated %}class="active"{% endif %}><a id="reports-tab" href="javascript:Datea.report.open_reports_tab();">VER APORTES</a></li>
				{% url new_report environment.slug active_category.slug as new_report_url%}
				<li><a id="new-report-tab" href="javascript:Datea.report.open_new_report_tab();">HAZ UN APORTE</a></li>
				{% url environment_tab environment.slug "people" as people_url%}
				<li><a id="people-tab" href="{{ people_url }}" rel="nav:people">PARTICIPANTES</a></li>
			</ul>
		</div>
	</div>
	
	<div id="body" class="environment htarget">
		<div class="container">
			{% block body %}
            <div id="environment-tabs-content" class="tab-content htarget">
            	
            	{# PROFILE #}
            	{% if user.is_authenticated %}
            	<div id="my-profile-tab-content" class="tab-pane env-tab htarget active">
            		{% render_full_profile user.get_profile environment %}
            	</div>
	            {% endif %}
            	
            	{# REPORTS #}
            	<div id="reports-tab-content" class="tab-pane env-tab htarget{% if not user.is_authenticated %} active{% endif %}">
            		{% include "datea_report/_reports_view_tab.html" %}
            	</div>
            	
            	{# MAKE A REPORT #}
            	<div id="new-report-tab-content" class="tab-pane env-tab htarget">
            		{% include "datea_report/_report_create.html" %}
            	</div>
            	
            	{# USERS #}
            	<div id="people-tab-content" class="tab-pane env-tab htarget">
            		{% load datea_profile_tags %}
            		{% render_profiles_tab environment %}
            	</div>
            	
            </div>
            {% endblock %}
    	</div>
    </div>
{% endblock%}

{% block extra_body %}
{{ block.super }}

{% include "datea_report/_action_start_bubble.html" %}

<div id="modal-win" class="modal fade" style="display:none">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">Ã—</a>
		<h3 class="modal-title">Modal header</h3>
	</div>
	<div class="modal-body">
		<p></p>
	</div>
	<div class="modal-footer">
	</div>
</div>
{% endblock %}
